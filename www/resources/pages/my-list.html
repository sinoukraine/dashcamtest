<template>
	<div data-name="my-list" class="page open-dashcam-page my-list">
		<div class="navbar">
			<div class="navbar-inner">
				<div class="left">
					<a class="panel-open" href="#">
						<i class="f7-icons icon-menu"></i>
					</a>
				</div>
				<div class="title">Home</div>
			</div>
		</div>

		<div class="toolbar toolbar-bottom" id="openCam">
			<div class="toolbar-inner">
				<a class="btn-cs" href="#">
					open dashcam
				</a>
			</div>
		</div>

		<div class="page-content">
			<div class="block">
				{{#if ShowCamList}}
				<p class="item-title open-title">
					Check the box of the desired dashcam and click the OPEN DASHCAM button.
				</p>
				{{else}}
				<div key="VirtualListPreloader" class="block text-align-center">
                    <div class="preloader color-blue"></div>
                </div>
				{{/if}}
			</div>
			<div class="list virtual-list open-cam-list no-hairlines">
				
			</div>
		</div>
	</div>
</template>

<script>
  // script must return component object
    return { 
        data: function () {
            var self = this;
            var ret = {
				ShowCamList: false
			};            

            return ret;
        },
		methods: {
			listHandler: function(a){	
				var self = this; 
				self.$setState({
                    ShowCamList: true,
                });		
				App.dialog.alert(a.length);			
				//var camArr = names.split(',');

				var items = [];
				for (var i = 1; i <= a.length; i++) {
					var pattern = /^AUTO-VOX/i;
					if (pattern.test(a[i])) {
						items.push({
							title: a[i],
							value: i,
						});
					}else{
						items.push({
							title: 'bla-bla',
							value: i,
						});
					}
				}

				var deletecamList = App.virtualList.create({
					// List Element
					el: '.open-cam-list',
					// Pass array with items
					items: items,
					// Custom search function for searchbar
					searchAll: function(query, items) {
						var found = [];
						for (var i = 0; i < items.length; i++) {
							if (items[i].title.toLowerCase().indexOf(query.toLowerCase()) >= 0 || query.trim() === '') found.push(i);
						}
						return found; //return array with mathced indexes
					},
					// List item Template7 template
					itemTemplate: '<li>' +
						'<label class="item-radio item-content">' +
						'<input type="radio" name="demo-radio" value="{{value}}" checked="checked"/>' +
						'<div class="item-media">' +
						'<div class="item-media-inner">' +
						'<p>DC</p>' +
						'</div>' +
						'</div>' +
						'<div class="item-inner">' +
						'<div class="item-title">{{title}}</div>' +
						'</div>' +
						'<i class="icon icon-radio"></i>' +
						'</label>' +
						'</li>',
					// Item height
					height: app.theme === 'ios' ? 73 : (app.theme === 'md' ? 73 : 73),
				});
			},	
			fail: function(e){
				var self = this; 
				self.$setState({
                    ShowCamList: false,
                });						
			}
		},
        on: {
            pageInit: function (e, page) {  
				var self = this;    
				
				WifiWizard.listNetworks(self.listHandler, self.fail);
				
				//self.$app.methods.getWifiList().then(response => {	
					//console.log(response);
				//});
				
				//var page = page.$el.find('.page-content'); 
								
                //self.$app.preloader.show();
				//var myPage = $$('.my-list');
				
				/*myPage.on('click', '#connectCam', function(e){
					VideoPlayer.play(API_LIVE_STREAM);
				});*/
            }
		}
    };
</script>
    